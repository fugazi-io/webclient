<!DOCTYPE html>
<html lang="en">
<head>
	<title></title>
	<meta charset="utf-8">
	<script>
		function getParams() {
			let data = window.location.search
				.substring(1)
				.split("&")
				.map(item => item.split("="))
				.find(item => item[0] === "state");

			if (!data || data.length !== 2) {
				return null;
			}

			try {
				return JSON.parse(decodeURIComponent(data[1]));
			} catch (e) { // in case the data was encoded twice
				return JSON.parse(decodeURIComponent(decodeURIComponent(data[1])));
			}
		}

		function joinUrl(base, path) {
			if (base.charAt(base.length - 1) !== "/") {
				base += "/";
			}

			return `${ base }${ path }.js`;
		}

		window.proxyData = getParams();

		[
			"core/dom",
			"core/types",
			"core/net",
			"core/utils",
			"channels/protocol",
			"channels/oAuth2ResponseDialog"
		].forEach(path => {
			let url = joinUrl(window.proxyData.scriptsBase, path);

			let element = document.createElement("script", { defer: "defer" });
			element.src = url;
			document.head.appendChild(element);
		});
	</script>
</head>
</html>
